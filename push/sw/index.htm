<html>
<head>
<link rel="manifest" href="manifest.json">
</head>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(function(registration) {
    // Registration was successful
    console.log('ServiceWorker registration successful with scope: ',    registration.scope);
  }).catch(function(err) {
    // registration failed :(
    console.log('ServiceWorker registration failed: ', err);
  });
}
else {
  console.log("ServiceWorker not supported :-(");
}



function requestPushPermission() {
  console.log('requestung push permisssion...');
  navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
    serviceWorkerRegistration.pushManager.subscribe()
      .then(function(pushSubscription) {
        console.log(pushSubscription);
        sendSubscription(pushSubscription);
      })
      .catch(function(e) {
        console.error('Unable to register for push', e);
      });
  });


}



function checkSubscription() {
  navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
    serviceWorkerRegistration.pushManager.getSubscription().then(
      function(pushSubscription) {
        console.log(pushSubscription);
        sendSubscription(pushSubscription);
        // Check we have everything we need to unsubscribe
        // if (!pushSubscription || !pushSubscription.unsubscribe) {
        //   return;
        
      }.bind(this)).catch(function(e) {
        console.error('Error thrown while checking push notifications. ' +
          'Most likely because push was never registered', e);
      });
  });
}


function sendSubscription(pushSubscription) {
  //uses jquery
    var url = 'http://mobiforge.com/m/subscribe.php';
$.ajax({
   type: 'GET',
    url: url,
    async: false,
    jsonpCallback: 'subCallback',
    contentType: "application/json",
    dataType: 'jsonp',
    success: function(json) {
       console.log(json);
    },
    error: function(e) {
       console.log(e.message);
    }
});
   

}

</script> 
<body>
Push test page<br />
<button onclick="requestPushPermission()">request push permission</button>
<button onclick="checkSubscription()">Check sub</button>
<br />


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

</body>

</html>
