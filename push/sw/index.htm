<html>
<head>
<link rel="manifest" href="manifest.json">
</head>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(function(registration) {
    // Registration was successful
    console.log('ServiceWorker registration successful with scope: ',    registration.scope);
  }).catch(function(err) {
    // registration failed :(
    console.log('ServiceWorker registration failed: ', err);
  });
}
else {
  console.log("ServiceWorker not supported :-(");
}



function requestPushPermission() {
  console.log('requestung push permisssion...');
  navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
    serviceWorkerRegistration.pushManager.subscribe()
      .then(function(pushSubscription) {
        console.log(pushSubscription);
        sendSubscription(pushSubscription);
      })
      .catch(function(e) {
        console.error('Unable to register for push', e);
      });
  });


}



function checkSubscription() {
  navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
    serviceWorkerRegistration.pushManager.getSubscription().then(
      function(pushSubscription) {
        console.log(pushSubscription);
        sendSubscription(pushSubscription);
        // Check we have everything we need to unsubscribe
        // if (!pushSubscription || !pushSubscription.unsubscribe) {
        //   return;
        
      }.bind(this)).catch(function(e) {
        console.error('Error thrown while checking push notifications. ' +
          'Most likely because push was never registered', e);
      });
  });
}

function fetchNotData() {
  fetch("http://mobiforge.com/m/latest.json").then(function(res) {
    res.json().then(function(data) {
          // Show notification
console.log(data);
          //self.registration.showNotification(data.title, {
          //body: data.body,
          //icon: data.icon,
          //tag: data.tag
        //})
    })
})
}


function fetchNotDataJSONP() {
  console.log('fecthing JSONP...');
  //uses jquery
   // var url = 'http://mobiforge.com/m/subscribe.php';
  $.getJSON("http://mobiforge.com/m/latest.php?callback=?", function(result){
   //response data are now in the result variable
   console.log(result);
  }
}


function sendSubscription(pushSubscription) {
  console.log('sending...');
  //uses jquery
   // var url = 'http://mobiforge.com/m/subscribe.php';
$.getJSON("http://mobiforge.com/m/subscribe.php?callback=?", function(result){
   //response data are now in the result variable
   console.log(result);
});
   

}

</script> 
<body>
Push test page<br />
<button onclick="requestPushPermission()">request push permission</button>
<button onclick="checkSubscription()">Check sub</button>
<button onclick="fetchNotData()">Fetch</button>
<button onclick="fetchNotDataJSONP()">FetchJSONP</button>
<br />


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

</body>

</html>
